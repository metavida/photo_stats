<!DOCTYPE html>
<html>
<head>
  <title>One Year</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.7.1/nv.d3.min.css" />
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/charts.css" />

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.7.1/nv.d3.min.js"></script>

</head>
<body>

<h1 id="intro">One Year of Photos</h1>
<p>
  One year ago I had the amazing joy of posting a big <strong>&quot;Yes!&quot;</strong> on <a href="http://arethetwinsbornyet.wrightkuhns.com">arethetwinsbornyet.wrightkuhns.com</a>
</p>
<p>
  Now, one year later, we've documented so many amazing memories!
</p>

<h2 id="total">We took <span id="total_count">over 7,000</span> photos of the boys!</h2>

<div id="total_chart" class="photo-line hide-x">
  <div class="xaxis"><div></div></div>
</div>

<p>We generally took photos evenly:</p>

<h2 id="dow">Photos per Day of the Week</h2>

<div id="dow_chart" class="photo-line hide-x">
  <div class="xaxis"><div></div></div>
</div>

<h2 id="kid">Photos per Kid</h2>
<div id="jvg_chart" class="photo-bar hide-y hide-x-tick"></div>

<p>But some days we went overboard :-D</p>

<h2 id="top10">Top 10 days</h2>
<div id="top10_table" class="photo-table"></div>


<script type="text/javascript">
//nv.log = function() {
//  args = [];
//  for (var i = 0; i < arguments.length; i++) { args.push(arguments[i]); }
//  console.log(args);
//}

d3.csv("data/cumulative_total.csv")
  .row(function(d) {
    return {key: d['day'], value: parseInt(d['count'], 10) }
  })

  .get(function(error,data) {
    nv.addGraph(function() {
      var chart = nv.models.lineChart()
            .margin(0)
            .x(function(d,i) { return i })
            .y(function(d,i) { return d.value })
            .interpolate('cardinal')
            ;
      chart.xAxis
          .showMaxMin(false)
          .tickFormat(function(d) {
            d = new Date(data[d].key);
            return d3.time.format('%d %b %Y')(d)
          })
          ;

      chart.yAxis
          .showMaxMin(false)
          .tickFormat(d3.format(',r'))
          ;

      d3.select('#total_chart')
        .append('svg')
        .datum([{ values: data, key: 'Number of Photos', area: true }])
        .transition()
        .duration(5000)
        .call(chart)
        ;

      d3.select("#total_count")
        .text(d3.format(',')(data[data.length-1].value))
        ;

      nv.utils.windowResize(chart.update);

      return chart;
    })
  })

  ;

d3.csv("data/per_day_of_week.csv")
  .row(function(d) {
    return {key: d['day'], value: parseInt(d['count'], 10) }
  })
  .get(function(error,data) {

    nv.addGraph(function() {
      var chart = nv.models.lineChart()
            .margin(0)
            .x(function(d,i) { d = new Date('2015','02',i+2); return d })
            .y(function(d,i) { return d.value })
            .interpolate('cardinal')
            ;

      chart.xAxis
          .showMaxMin(false)
          .tickFormat(function(d) { return d3.time.format('%A')(new Date(d)) })
          ;

      chart.yAxis
          .showMaxMin(false)
          .tickFormat(d3.format(',r'))
          //.scale().domain([0, )
          //.scale().domain([10, 1000])
          ;

      chart.forceY([d3.min(data.map(function(d) { return d.value })) - 500, 1000]);
      chart.lines.scatter.id("dow_chart_line");

      d3.select('#dow_chart')
        .append('svg')
        .datum([{ values: data, key: 'Photos by Day of the Week', area: true }])
        .transition()
        .duration(0)
        .call(chart)
        ;

      nv.utils.windowResize(chart.update);

      return chart;
    });
  })
  ;

d3.csv("data/per_subject.csv")
  .row(function(d) {
    return {key: d['subject'] || 'Both / Neither', value: parseInt(d['count'], 10) }
  })
  .get(function(error,data) {

    nv.addGraph(function() {
      var chart = nv.models.discreteBarChart()
            .margin(0)
            .x(function(d,i) { return d.key })
            .y(function(d,i) { return d.value })
            .tooltips(false)
            .showValues(true)
            .color(function(d) { return "rgb(31, 119, 180)" })
            ;

      d3.select('#jvg_chart')
        .append('svg')
        .datum([{ values: data, key: "Photos by Subject" }])
        .call(chart)
        ;

      nv.utils.windowResize(chart.update);

      return chart;
    });
  })
  ;

d3.csv("data/top_10.csv")
  .row(function(d) {
    var date = d3.time.format('%d %b %Y')(new Date(d['day']));
    return {
      'day':date,
      'count':parseInt(d['count'], 10),
      'photo':d['photo'],
      'note':d['note']
    };
  })
  .get(function(error,data) {
    var photo_to_img = function(d, even) {
      var photos = d['photo'].split(/\+/)
      return photos.map(function(img) {
        if(img.length > 0)
          return '\<img src="images/photos/'+img+'" alt="'+d['note']+'" class="'+(even ? 'even' : 'odd')+'" />';
        return '';
      }).join(' ');
    }

    var tr = d3.select('#top10_table')
      .append('table').selectAll("tr")
      .data(data)
      .enter().append("tr");
      ;

    var even = true;
    tr.selectAll("td")
      .data(function(d) {
        console.log(d);
        even = !even;
        return [
          d['count']+' on '+d['day'],
          photo_to_img(d,even),
          d['note']
        ];
      })
      .enter().append("td")
      .html(function(d,i) {
        return d;
      })
      ;
  })
  ;

</script>
</body>
</html>